@using PagedList;
@using PagedList.Mvc;

@model IPagedList<Data.Model.File>

@{
    ViewBag.Title = "Список файлов";

    var isAdmin = HttpContext.Current.User.IsInRole("Admin");
}

@if (Model.Any())
{
    <div>
        <table class="table table-striped">
            <thead>
                <tr >
                    <th scope="col">Имя файла</th>
                    <th scope="col">Дата загрузки</th>
                    <th scope="col">Тип файла</th>
                    <th scope="col" class="centered">Скачать</th>
                    @if (isAdmin)
                    {
                        <th scope="col" class="centered">Удалить</th>
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var file in Model)
                {
                    <tr id="@file.Id">
                        <td>@file.Name</td>
                        <td>@file.UploadDate.ToString("g")</td>
                        <td>@file.Extension</td>
                        <td class="centered">
                            <a href="@Url.Action("Download","Downloads", new { fileId = file.Id })"><i class="glyphicon glyphicon glyphicon-download-alt file-icon"></i></a>
                        </td>
                        @if (isAdmin)
                        {
                            <td class="centered">
                                <a onclick="deleteFile(@file.Id)"><i class="glyphicon glyphicon-floppy-remove file-icon"></i></a>
                            </td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <br />
    <div>
        Страница @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) из @Model.PageCount
        @Html.PagedListPager(Model, page => Url.Action("FileList", new { page }))
    </div>
}
else
{
    <span>
        Пока что ничего не загружено
    </span>
}

<script type="text/javascript">
    function deleteFile(fileId) {
        let fileTableRowSelector = "#" + fileId;
        $(fileTableRowSelector).hide();
        $.ajax({
            type: `POST`,
            url: `@Url.Action("Delete", "Files")?fileId=` + fileId,
            contentType: `application/json; charset=utf-8`,
            dataType: `json`
        });
    }
</script>

<style>
    table {
        margin-top: 30px;
    }

    .centered {
        text-align:center;
    }

    .file-icon:hover {
        color:limegreen;
    }

    .pagination {
        margin: 10px 0;
    }
</style>